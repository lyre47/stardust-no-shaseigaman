<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿå°˜çš„å°„ç²¾ç®¡ç†è®­ç»ƒâ™¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        .scrolling-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            animation: scrollText 20s linear infinite;
            font-size: 20px;
            line-height: 1.5;
            color: #fff;
            pointer-events: none;
        }

        @keyframes scrollText {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .title {
            text-align: center;
            color: white;
            font-size: 36px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .difficulty-screen, .game-screen, .result-screen {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .difficulty-btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            font-weight: bold;
        }

        .easy { background: linear-gradient(135deg, #84fab0, #8fd3f4); }
        .normal { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .hard { background: linear-gradient(135deg, #fa709a, #fee140); }
        .extreme { background: linear-gradient(135deg, #30cfd0, #330867); }

        .difficulty-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .timer {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            color: #333;
        }

        .countdown-label {
            text-align: center;
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .speed-indicator {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .rhythm-display {
            text-align: center;
            font-size: 48px;
            margin: 20px 0;
            height: 80px;
            color: #e91e63;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rhythm-text {
            transition: transform 0.1s ease-in-out;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .taunt-message {
            text-align: center;
            font-size: 18px;
            color: #666;
            margin: 20px 0;
            min-height: 60px;
            padding: 15px;
            background: rgba(255,192,203,0.2);
            border-radius: 10px;
            font-style: italic;
        }

        .control-buttons {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .control-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .surrender-btn {
            background: #ffc107;
            color: #333;
        }

        .fail-btn {
            background: #f44336;
            color: white;
        }

        .punishment-display {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,0,0,0.1);
            border-radius: 10px;
            border: 2px solid #f44336;
        }

        .hidden {
            display: none;
        }

        .pulse {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="scrolling-bg" id="scrollingBg"></div>

    <div class="container">
        <h1 class="title">âœ¨ æ˜Ÿå°˜çš„å°„ç²¾ç®¡ç†è®­ç»ƒ âœ¨</h1>

        <div class="difficulty-screen" id="difficultyScreen">
            <h2 style="text-align: center; margin-bottom: 20px;">é€‰æ‹©ä½ çš„æŠ˜ç£¨ç¨‹åº¦â™¡</h2>
            <button class="difficulty-btn easy" onclick="startGame('easy')">
                ğŸŒ¸ æ¸©æŸ”æ¨¡å¼ - åˆæ¬¡ä½“éªŒå¯¸æ­¢çš„ä½ 
            </button>
            <button class="difficulty-btn normal" onclick="startGame('normal')">
                ğŸ’• æ ‡å‡†æ¨¡å¼ - æƒ³è¦æ›´å¤šåˆºæ¿€çš„ä½ 
            </button>
            <button class="difficulty-btn hard" onclick="startGame('hard')">
                ğŸ”¥ å›°éš¾æ¨¡å¼ - è¿½æ±‚æé™å¿«æ„Ÿçš„ä½ 
            </button>
            <button class="difficulty-btn extreme" onclick="startGame('extreme')">
                âš¡ åœ°ç‹±æ¨¡å¼ - ç»å¯¹æ— æ³•é€šå…³çš„ç»ˆææŒ‘æˆ˜
            </button>
        </div>

        <div class="game-screen hidden" id="gameScreen">
            <div class="countdown-label">è·ç¦»èƒœåˆ©è¿˜æœ‰</div>
            <div class="timer" id="timer">00:00</div>
            <div class="speed-indicator" id="speedIndicator">å‡†å¤‡å¼€å§‹...</div>
            <div class="rhythm-display" id="rhythmDisplay">
                <span class="rhythm-text" id="rhythmText"></span>
            </div>
            <div class="taunt-message" id="tauntMessage">å‡†å¤‡å¥½äº†å—ï¼Ÿé©¬ä¸Šå°±è¦å¼€å§‹äº†å“¦â™¡</div>

            <div class="control-buttons">
                <button class="control-btn surrender-btn" onclick="surrender()">
                    æˆ‘è¦å¿ä¸ä½äº†...æŠ•é™
                </button>
                <button class="control-btn fail-btn" onclick="failed()">
                    å•Š...å°„äº†...
                </button>
            </div>
        </div>

        <div class="result-screen hidden" id="resultScreen">
            <h2 id="resultTitle"></h2>
            <div class="punishment-display" id="punishmentDisplay"></div>
            <button class="difficulty-btn normal" onclick="location.reload()" style="margin-top: 20px;">
                å†æ¥ä¸€æ¬¡
            </button>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const gameConfig = {
            easy: {
                duration: [180, 240], // 3-4åˆ†é’Ÿ
                segments: [3, 4],
                speeds: {
                    stop: 0,
                    slow: [8, 12],
                    medium: [15, 20],
                    fast: [25, 30],
                    extreme: [35, 40]
                }
            },
            normal: {
                duration: [300, 420], // 5-7åˆ†é’Ÿ
                segments: [4, 6],
                speeds: {
                    stop: 0,
                    slow: [5, 8],
                    medium: [12, 18],
                    fast: [22, 28],
                    extreme: [32, 38]
                }
            },
            hard: {
                duration: [480, 600], // 8-10åˆ†é’Ÿ
                segments: [6, 8],
                speeds: {
                    stop: 0,
                    slow: [3, 5],
                    medium: [10, 15],
                    fast: [20, 25],
                    extreme: [30, 35]
                }
            },
            extreme: {
                duration: [600, 900], // 10-15åˆ†é’Ÿ
                segments: [8, 12],
                speeds: {
                    stop: 0,
                    slow: [2, 3],
                    medium: [8, 12],
                    fast: [18, 22],
                    extreme: [28, 32]
                }
            }
        };

        // ç¾è¾±æ–‡æ¡ˆ
        const taunts = {
            stop: [
                "åœä¸‹æ¥å“¦~ ä¸è®¸åŠ¨ä½ çš„å°è‚‰æ£’â™¡",
                "å“å‘€ï¼Œå°±è¿™æ ·å¿ä½å§ï¼ŒçœŸå¯æ€œ~",
                "çœ‹ä½ æ†‹å¾—æ»¡è„¸é€šçº¢ï¼Œå¥½å¯çˆ±å‘¢â™ª",
                "è¿™å°±æ˜¯å¯¸æ­¢çš„æ»‹å‘³ï¼Œå¥½å¥½å“å°å§~",
                "ä¸è®¸ç¢°å“¦ï¼Œè®©å®ƒè‡ªå·±è·³åŠ¨å§â™¡",
                "å‘µå‘µï¼Œæ˜¯ä¸æ˜¯å¾ˆæƒ³ç»§ç»­ï¼Ÿå¯æƒœä¸è¡Œå‘¢~",
                "ä½ çš„å°é¸¡å·´åœ¨æŠ½æå‘¢ï¼Œå¿ä½å“¦â™¡",
                "å°±è¿™æ ·çœ‹ç€å®ƒæµæ°´å§ï¼Œä¸è®¸æ“¦~"
            ],
            slow: [
                "æ…¢~æ…¢~åœ°~æ¥ï¼Œä¸è¦ç€æ€¥å“¦â™¡",
                "å°±è¿™æ ·æ¸©æŸ”åœ°æŠšæ‘¸è‡ªå·±å§~",
                "æ„Ÿå—æ¯ä¸€ä¸‹çš„å¿«æ„Ÿï¼Œåˆ«æ¼æ‰å“¦â™ª",
                "è¿™ç§ç¼“æ…¢çš„æŠ˜ç£¨ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ£’ï¼Ÿ",
                "æ…¢æ…¢äº«å—å§ï¼Œè¿˜æœ‰å¾ˆé•¿æ—¶é—´å‘¢~",
                "åƒä¸ªå¤„ç”·ä¸€æ ·æ…¢æ…¢æ’¸å§â™¡",
                "è¿™ä¹ˆæ…¢éƒ½å¿«å—ä¸äº†äº†ï¼ŸçœŸæ²¡ç”¨å‘¢~"
            ],
            medium: [
                "ç¨å¾®å¿«ä¸€ç‚¹äº†å“¦ï¼Œè·Ÿä¸ŠèŠ‚å¥â™¡",
                "ä¸­ç­‰é€Ÿåº¦ï¼Œä¸å¿«ä¸æ…¢åˆšåˆšå¥½~",
                "ä¿æŒè¿™ä¸ªèŠ‚å¥ï¼Œæ„Ÿè§‰å¦‚ä½•ï¼Ÿ",
                "ä¸è¦ä¹±äº†èŠ‚å¥å“¦ï¼Œæ˜Ÿå°˜åœ¨çœ‹ç€å‘¢â™ª",
                "ä½ çš„è¡¨æƒ…å¼€å§‹å˜å¾—è‰²æƒ…äº†å‘¢~",
                "å‘¼å¸å˜é‡äº†å“¦ï¼Œå…´å¥‹äº†å—ï¼Ÿ"
            ],
            fast: [
                "å¿«ç‚¹ï¼ç”¨åŠ›æ’¸ä½ çš„å°é¸¡å·´ï¼",
                "å°±æ˜¯è¿™æ ·ï¼Œå¿«é€Ÿæ‘©æ“¦å§â™¡",
                "å“‡ï¼Œä½ çš„è¡¨æƒ…å¥½è‰²æƒ…å“¦~",
                "å¿«è¦å¿ä¸ä½äº†å§ï¼ŸåšæŒä½ï¼",
                "ä½ çš„é¾Ÿå¤´éƒ½å……è¡€äº†å‘¢ï¼Œå¥½å¯çˆ±â™¡",
                "è¿™ä¸ªé€Ÿåº¦è®©ä½ å¾ˆçˆ½å§ï¼Ÿä½†ä¸è®¸å°„å“¦~"
            ],
            extreme: [
                "æé€Ÿå†²åˆºï¼ä½¿å‡ºå…¨åŠ›å§ï¼",
                "å°±åƒè¦å°„ç²¾ä¸€æ ·ç”¨åŠ›æ’¸ï¼",
                "ä½†æ˜¯ä¸è®¸å°„å“¦ï¼Œå¿ä½å¿ä½â™¡",
                "çœ‹ä½ è¿™å‰¯æ¨¡æ ·ï¼ŒçœŸæ˜¯å¤ªæœ‰è¶£äº†ï¼",
                "é©¬ä¸Šå°±è¦çˆ†å‘äº†å§ï¼Ÿåœï¼",
                "ä½ çš„å°è‚‰æ£’è¦åæ‰äº†å‘¢~"
            ]
        };

        // èƒŒæ™¯æ»šåŠ¨æ–‡å­—
        const bgTexts = [
            "ä½ å°±æ˜¯ä¸ªç»¿å¸½è´±ç‹—",
            "åºŸç‰©çš„å°é¸¡å·´åªé…è¢«ç®¡ç†",
            "è¿è‡ªæ…°éƒ½è¦è¢«æ§åˆ¶çš„å¯æ€œè™«",
            "ä½ çš„å¥³æœ‹å‹æ­£åœ¨è¢«åˆ«äººè‚",
            "è¿™ä¹ˆå°çš„é¸¡å·´ä¹Ÿæƒ³å°„ç²¾ï¼Ÿ",
            "æ—©æ³„åºŸç‰©å°±è¯¥è¢«å¥½å¥½è°ƒæ•™",
            "çœ‹çœ‹ä½ è¿™å‰¯æ·«è¡çš„æ ·å­",
            "æ˜æ˜æ˜¯ç”·äººå´åƒæ¯ç‹—ä¸€æ ·å‘æƒ…",
            "ä½ å°±é€‚åˆè¢«é›Œå •æˆå°æ¯ç‹—",
            "è¿™å‰¯èº«ä½“å·²ç»ç¦»ä¸å¼€å¯¸æ­¢äº†å§",
            "åºŸç‰©å°±è¯¥è¢«ç¾è¾±ç€è‡ªæ…°",
            "ä½ çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è¢«NTR",
            "çœ‹ä½ æµçš„å‰åˆ—è…ºæ¶²çœŸæ¶å¿ƒ",
            "è¿™ä¹ˆå¿«å°±è¦æŠ•é™äº†ï¼ŸçœŸæ²¡ç”¨",
            "ä½ é…å°„ç²¾å—ï¼Ÿä½ ä¸é…",
            "ç»¿å¸½å¥´å°±è¯¥ä¸€è¾¹å“­ä¸€è¾¹æ’¸",
            "æƒ³è±¡ä½ å¥³å‹è¢«è‚çš„æ ·å­å§",
            "ä½ åªèƒ½é å¹»æƒ³åˆ«äººè‚å¥¹æ¥å…´å¥‹",
            "åºŸç‰©çš„ç²¾æ¶²ä¸€æ–‡ä¸å€¼",
            "è¿™å°±æ˜¯ä½ å”¯ä¸€çš„æ€§ç”Ÿæ´»äº†"
        ];

        // æƒ©ç½šåˆ—è¡¨
        const punishments = [
            "è¿ç»­å¯¸æ­¢5æ¬¡ï¼Œæ¯æ¬¡åœ¨å³å°†å°„ç²¾å‰åœæ­¢",
            "å¯¹ç€é•œå­è¯´100é'æˆ‘æ˜¯ç»¿å¸½è´±ç‹—'",
            "ç”¨å†°å—æ‘©æ“¦é¾Ÿå¤´ç›´åˆ°å®Œå…¨è½¯æ‰",
            "è·ªåœ¨åœ°ä¸Šè‡ªæ‰‡è€³å…‰50ä¸‹",
            "è¿ç»­1å°æ—¶ä¸è®¸ç¢°è‡ªå·±çš„æ€§å™¨",
            "å†™500å­—çš„è‡ªæˆ‘ç¾è¾±ä½œæ–‡",
            "å½•ä¸‹è‡ªå·±è¯´'æˆ‘ä¸é…å°„ç²¾'çš„è§†é¢‘",
            "ç”¨ç‰™è†æ¶‚æ»¡é¾Ÿå¤´å¿å—åˆºæ¿€10åˆ†é’Ÿ",
            "è¿ç»­æ·±è¹²100ä¸ªè®©è¡€æ¶²ç¦»å¼€ä¸‹ä½“",
            "å¯¹ç€å¥³å‹ç…§ç‰‡è¯´'è¯·åŸè°…æˆ‘è¿™ä¸ªåºŸç‰©'",
            "æŠŠè‡ªå·±çš„å†…è£¤å¥—åœ¨å¤´ä¸Šè·ªç€åçœ",
            "ç”¨æ©¡çš®ç­‹å¼¹é¾Ÿå¤´30ä¸‹",
            "åœ¨èº«ä¸Šå†™'æ—©æ³„åºŸç‰©'å¹¶ä¿æŒä¸€å¤©",
            "è¿ç»­çœ‹NTRæœ¬å­ä½†ä¸è®¸å‹ƒèµ·",
            "è·ªç€å­¦ç‹—å«100å£°",
            "ç”¨å¤¹å­å¤¹ä½ä¹³å¤´å¿å—30åˆ†é’Ÿ",
            "åƒè‡ªå·±çš„å‰åˆ—è…ºæ¶²",
            "æŠŠéœ‡åŠ¨å™¨ç»‘åœ¨é¾Ÿå¤´ä¸Šå¿å—ä¸å°„",
            "ä¸€è¾¹æè‡ªå·±å¤§è…¿ä¸€è¾¹è¯´ç¾è¾±è‡ªå·±çš„è¯",
            "ç©¿å¥³è£…è‡ªæ…°ä½†ä¸è®¸å°„",
            "å¯¹ç€é»‘å±å¹•è¯´å‡ºè‡ªå·±æœ€ç¾è€»çš„æ€§å¹»æƒ³",
            "ç”¨æ‰‹æŒ‡æ’è‡ªå·±åé¢ä½†ä¸è®¸ç¢°å‰é¢",
            "æŠŠæ‰€æœ‰AVåˆ æ‰å¹¶å‘èª“ä¸€ä¸ªæœˆä¸çœ‹",
            "è¿ç»­è¾¹ç¼˜æ§åˆ¶åˆ°å“­å‡ºæ¥ä¸ºæ­¢",
            "è·ªç€ç»™æƒ³è±¡ä¸­çš„ç”·å‹é“æ­‰",
            "ä¸€è¾¹æ‰“è‡ªå·±çš„è›‹è›‹ä¸€è¾¹ç¬‘",
            "å¤§å£°æœ—è¯»NTRå°è¯´çš„é«˜æ½®éƒ¨åˆ†",
            "æ¨¡ä»¿å¥³æ€§è‡ªæ…°çš„åŠ¨ä½œå’Œå£°éŸ³",
            "ä¿æŒå‹ƒèµ·çŠ¶æ€åš100ä¸ªä»°å§èµ·å",
            "å¯¹ç€è‡ªå·±æœ€å–œæ¬¢çš„è§’è‰²è¯´å¯¹ä¸èµ·"
        ];

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            difficulty: null,
            duration: 0,
            segments: [],
            currentSegment: 0,
            currentSpeed: 0,
            timeRemaining: 0,
            intervalId: null,
            rhythmInterval: null
        };

        // åˆå§‹åŒ–èƒŒæ™¯æ–‡å­—
        function initBackground() {
            const bgDiv = document.getElementById('scrollingBg');
            bgDiv.innerHTML = bgTexts.map(text =>
                `<span style="margin: 0 50px;">${text}</span>`
            ).join('').repeat(10);
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame(difficulty) {
            gameState.difficulty = difficulty;
            const config = gameConfig[difficulty];

            // éšæœºç”Ÿæˆæ¸¸æˆå‚æ•°
            gameState.duration = randomBetween(config.duration[0], config.duration[1]);
            gameState.timeRemaining = gameState.duration;
            const segmentCount = randomBetween(config.segments[0], config.segments[1]);

            // ç”Ÿæˆæ®µè½ç»“æ„
            gameState.segments = generateSegments(segmentCount, gameState.duration, config);

            // åˆ‡æ¢ç•Œé¢
            document.getElementById('difficultyScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');

            // å¼€å§‹æ¸¸æˆå¾ªç¯
            startGameLoop();
        }

        // ç”Ÿæˆæ®µè½ç»“æ„
        function generateSegments(count, totalDuration, config) {
            const segments = [];
            const segmentDuration = Math.floor(totalDuration / count);

            for (let i = 0; i < count; i++) {
                const isLast = i === count - 1;
                const segment = {
                    duration: segmentDuration,
                    phases: []
                };

                if (isLast) {
                    // æœ€åä¸€æ®µï¼šå°„ç²¾æ®µ
                    segment.phases = generateFinalSegment(segmentDuration, config);
                } else {
                    // æ™®é€šæ®µï¼šä»¥å¯¸æ­¢ç»“æŸ
                    segment.phases = generateNormalSegment(segmentDuration, config);
                }

                segments.push(segment);
            }

            return segments;
        }

        // ç”Ÿæˆæ™®é€šæ®µè½
        function generateNormalSegment(duration, config) {
            const phases = [];
            let remainingTime = duration;

            // å¼€å§‹ï¼šæ…¢é€Ÿçƒ­èº«
            phases.push({
                speed: 'slow',
                duration: Math.min(10, remainingTime),
                strokes: randomBetween(...config.speeds.slow)
            });
            remainingTime -= 10;

            // ä¸­é—´ï¼šé€æ¸åŠ é€Ÿ
            while (remainingTime > 15) {
                const speedChoice = Math.random();
                let speed, strokeRange;

                if (speedChoice < 0.3) {
                    speed = 'slow';
                    strokeRange = config.speeds.slow;
                } else if (speedChoice < 0.7) {
                    speed = 'medium';
                    strokeRange = config.speeds.medium;
                } else {
                    speed = 'fast';
                    strokeRange = config.speeds.fast;
                }

                const phaseDuration = randomBetween(5, 15);
                phases.push({
                    speed: speed,
                    duration: Math.min(phaseDuration, remainingTime - 15),
                    strokes: randomBetween(...strokeRange)
                });
                remainingTime -= phaseDuration;
            }

            // ç»“å°¾ï¼šæé€Ÿåå¯¸æ­¢
            if (remainingTime > 5) {
                phases.push({
                    speed: 'extreme',
                    duration: remainingTime - 5,
                    strokes: randomBetween(...config.speeds.extreme)
                });
            }

            // å¯¸æ­¢
            phases.push({
                speed: 'stop',
                duration: 5,
                strokes: 0
            });

            return phases;
        }

        // ç”Ÿæˆæœ€ç»ˆæ®µè½ï¼ˆå°„ç²¾æ®µï¼‰
        function generateFinalSegment(duration, config) {
            const phases = [];
            let remainingTime = duration;

            // é€æ¸å‡æ¸©
            const warmupTime = Math.floor(duration * 0.6);
            let currentTime = 0;

            while (currentTime < warmupTime) {
                const progress = currentTime / warmupTime;
                let speed, strokeRange;

                if (progress < 0.3) {
                    speed = 'medium';
                    strokeRange = config.speeds.medium;
                } else if (progress < 0.6) {
                    speed = 'fast';
                    strokeRange = config.speeds.fast;
                } else {
                    speed = 'extreme';
                    strokeRange = config.speeds.extreme;
                }

                const phaseDuration = randomBetween(5, 10);
                phases.push({
                    speed: speed,
                    duration: phaseDuration,
                    strokes: randomBetween(...strokeRange)
                });
                currentTime += phaseDuration;
            }

            // æœ€ç»ˆå†²åˆº
            phases.push({
                speed: 'extreme',
                duration: duration - currentTime,
                strokes: config.speeds.extreme[1],
                isFinal: true
            });

            return phases;
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function startGameLoop() {
            let currentSegmentIndex = 0;
            let currentPhaseIndex = 0;
            let phaseTimeLeft = 0;

            gameState.intervalId = setInterval(() => {
                gameState.timeRemaining--;
                updateTimer(gameState.timeRemaining);

                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (gameState.timeRemaining <= 0) {
                    gameComplete();
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢é˜¶æ®µ
                if (phaseTimeLeft <= 0) {
                    const segment = gameState.segments[currentSegmentIndex];
                    const phase = segment.phases[currentPhaseIndex];

                    if (!phase) {
                        // åˆ‡æ¢åˆ°ä¸‹ä¸€æ®µ
                        currentSegmentIndex++;
                        currentPhaseIndex = 0;

                        if (currentSegmentIndex >= gameState.segments.length) {
                            // æ¸¸æˆç»“æŸ
                            gameComplete();
                            return;
                        }
                    } else {
                        // æ‰§è¡Œå½“å‰é˜¶æ®µ
                        executePhase(phase);
                        phaseTimeLeft = phase.duration;
                        currentPhaseIndex++;
                    }
                }

                phaseTimeLeft--;
            }, 1000);
        }

        // æ‰§è¡Œé˜¶æ®µ
        function executePhase(phase) {
            const speedText = {
                stop: 'ğŸ›‘ å¯¸æ­¢ï¼åœä¸‹æ¥ï¼',
                slow: 'ğŸŒ æ…¢é€Ÿæ¨¡å¼',
                medium: 'âš¡ ä¸­é€Ÿæ¨¡å¼',
                fast: 'ğŸ”¥ å¿«é€Ÿæ¨¡å¼',
                extreme: 'ğŸ’¥ æé€Ÿå†²åˆºï¼'
            };

            document.getElementById('speedIndicator').textContent =
                speedText[phase.speed] + (phase.strokes ? ` - ${phase.strokes}ä¸‹/5ç§’` : '');

            // æ›´æ–°ç¾è¾±æ–‡æ¡ˆ
            const tauntArray = taunts[phase.speed] || taunts.medium;
            const randomTaunt = tauntArray[Math.floor(Math.random() * tauntArray.length)];
            document.getElementById('tauntMessage').textContent = randomTaunt;

            // æ›´æ–°èŠ‚å¥æ˜¾ç¤º
            updateRhythm(phase);

            // ç‰¹æ®Šå¤„ç†æœ€ç»ˆé˜¶æ®µ
            if (phase.isFinal) {
                document.getElementById('speedIndicator').style.background =
                    'linear-gradient(135deg, #ff0000, #ff6b6b)';
                document.getElementById('tauntMessage').textContent =
                    'ğŸ’¦ å¯ä»¥å°„äº†ï¼å°½æƒ…é‡Šæ”¾å§ï¼ç”¨åŠ›å°„å‡ºæ¥ï¼ğŸ’¦';
            }
        }

        // æ›´æ–°èŠ‚å¥æ˜¾ç¤º - ä¿®æ”¹ä¸ºå¿ƒè·³å¼è·³åŠ¨
        function updateRhythm(phase) {
            if (gameState.rhythmInterval) {
                clearInterval(gameState.rhythmInterval);
            }

            const rhythmText = document.getElementById('rhythmText');

            if (phase.strokes > 0) {
                rhythmText.textContent = 'ã‚·ã‚³ã‚·ã‚³';
                const interval = 5000 / phase.strokes; // è®¡ç®—æ¯æ¬¡è·³åŠ¨çš„é—´éš”

                gameState.rhythmInterval = setInterval(() => {
                    // åˆ›å»ºå¿ƒè·³å¼ç¼©æ”¾æ•ˆæœ
                    rhythmText.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        rhythmText.style.transform = 'scale(1)';
                    }, interval * 0.3); // è·³åŠ¨æŒç»­æ—¶é—´çº¦ä¸ºé—´éš”çš„30%
                }, interval);
            } else {
                rhythmText.textContent = 'âœ‹ ä¸è®¸åŠ¨ï¼';
                rhythmText.style.transform = 'scale(1)';
            }
        }

        // æ›´æ–°è®¡æ—¶å™¨ - ä¿®æ”¹ä¸ºå€’è®¡æ—¶
        function updateTimer(secondsRemaining) {
            const minutes = Math.floor(secondsRemaining / 60);
            const secs = secondsRemaining % 60;
            document.getElementById('timer').textContent =
                `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

            // æ—¶é—´ç´§è¿«æ—¶å˜çº¢
            if (secondsRemaining <= 30) {
                document.getElementById('timer').style.color = '#f44336';
            } else if (secondsRemaining <= 60) {
                document.getElementById('timer').style.color = '#ff9800';
            } else {
                document.getElementById('timer').style.color = '#333';
            }
        }

        // æŠ•é™
        function surrender() {
            clearInterval(gameState.intervalId);
            clearInterval(gameState.rhythmInterval);

            const punishment = punishments[Math.floor(Math.random() * punishments.length)];

            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');
            document.getElementById('resultTitle').textContent = 'ğŸ˜¢ ä½ æŠ•é™äº†...';
            document.getElementById('resultTitle').style.color = '#ff9800';
            document.getElementById('punishmentDisplay').innerHTML = `
                <h3>æŠ•é™çš„ä»£ä»·ï¼š</h3>
                <p style="margin: 10px 0;">é¦–å…ˆï¼Œç«‹åˆ»æ¯ç­ä½ çš„é«˜æ½®ï¼ç”¨æ‰‹æŒç”¨åŠ›æ‹æ‰“é¾Ÿå¤´ç›´åˆ°è½¯æ‰ï¼</p>
                <p style="margin: 10px 0; font-weight: bold;">ç„¶åæ‰§è¡Œæƒ©ç½šï¼š</p>
                <p style="color: #d32f2f; font-size: 18px;">${punishment}</p>
            `;
        }

        // å¤±è´¥
        function failed() {
            clearInterval(gameState.intervalId);
            clearInterval(gameState.rhythmInterval);

            const punishment1 = punishments[Math.floor(Math.random() * punishments.length)];
            const punishment2 = punishments[Math.floor(Math.random() * punishments.length)];

            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');
            document.getElementById('resultTitle').textContent = 'ğŸ’¦ ä½ å¤±è´¥äº†ï¼æ—©æ³„åºŸç‰©ï¼';
            document.getElementById('resultTitle').style.color = '#f44336';
            document.getElementById('punishmentDisplay').innerHTML = `
                <h3>å¤±è´¥è€…çš„åŒé‡æƒ©ç½šï¼š</h3>
                <p style="margin: 10px 0; color: #d32f2f;">ä½ è¿™ä¸ªç®¡ä¸ä½è‡ªå·±é¸¡å·´çš„åºŸç‰©ï¼</p>
                <p style="margin: 10px 0;">æƒ©ç½š1ï¼š</p>
                <p style="color: #d32f2f; font-size: 18px; margin: 10px 0;">${punishment1}</p>
                <p style="margin: 10px 0;">æƒ©ç½š2ï¼š</p>
                <p style="color: #d32f2f; font-size: 18px;">${punishment2}</p>
            `;
        }

        // æ¸¸æˆå®Œæˆ
        function gameComplete() {
            clearInterval(gameState.intervalId);
            clearInterval(gameState.rhythmInterval);

            const reward = punishments[Math.floor(Math.random() * 10)];

            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');
            document.getElementById('resultTitle').textContent = 'ğŸ‰ æ­å–œé€šå…³ï¼';
            document.getElementById('resultTitle').style.color = '#4caf50';
            document.getElementById('punishmentDisplay').innerHTML = `
                <h3 style="color: #4caf50;">ä½ æˆåŠŸå®Œæˆäº†è®­ç»ƒï¼</h3>
                <p style="margin: 10px 0;">ä½œä¸ºå¥–åŠ±ï¼Œä½ å¯ä»¥é€‰æ‹©ï¼š</p>
                <p style="margin: 10px 0;">1. å¥½å¥½äº«å—è¿™æ¬¡å°„ç²¾çš„ä½™éŸµ</p>
                <p style="margin: 10px 0;">2. æˆ–è€…æ‰§è¡Œä¸€ä¸ª"å¥–åŠ±ä»»åŠ¡"ï¼š</p>
                <p style="color: #2196f3; font-size: 18px;">${reward}</p>
                <p style="margin-top: 15px; font-style: italic;">çœŸæ˜¯ä¸ªå¬è¯çš„å¥½å­©å­å‘¢â™¡</p>
            `;
        }

        // å·¥å…·å‡½æ•°
        function randomBetween(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // åˆå§‹åŒ–
        initBackground();
    </script>
</body>
</html>
